# Установка времени забега

## Описание

Добавлена новая функциональность для установки даты и времени забега через Telegram бота с автоматической синхронизацией с мини-приложением.

## Как использовать

### 1. Установка времени забега через бота

1. Откройте Telegram бота
2. Нажмите кнопку "⏰ Установить время забега" в админ-панели
3. Введите дату и время в формате: `ДД.ММ.ГГГГ ЧЧ:ММ`
   - Пример: `01.10.2025 14:00`
4. Бот автоматически установит время начала и окончания забега (24 часа)

### 2. Автоматическая синхронизация

- Мини-приложение автоматически загружает актуальное время забега при запуске
- Таймеры и статистика обновляются в реальном времени
- Дата забега в заголовке приложения обновляется автоматически

### 3. API Endpoints

#### Получение времени забега
```
GET /api/set_race_time
```

#### Установка времени забега
```
POST /api/set_race_time
Content-Type: application/json

{
  "race_start": "2025-10-01T14:00:00+03:00",
  "race_end": "2025-10-02T14:00:00+03:00"
}
```

### 4. База данных

Время забега сохраняется в таблице `race_time`:
- `race_start` - время начала забега (ISO 8601)
- `race_end` - время окончания забега (ISO 8601)
- `updated_at` - время последнего обновления

### 5. Время по умолчанию

Если время забега не установлено, используется время по умолчанию:
- Начало: 1 октября 2025, 14:00 (UTC+3)
- Окончание: 2 октября 2025, 14:00 (UTC+3)

## Технические детали

### Файлы, которые были изменены:

1. **bot/bot.js** - добавлена кнопка и обработка установки времени
2. **netlify/functions/bot.js** - аналогичные изменения для Netlify версии
3. **netlify/functions/set_race_time.js** - новый API endpoint для Netlify
4. **public/app.js** - загрузка динамического времени забега
5. **public/index.html** - обновление отображения даты
6. **server.js** - API endpoints для локального сервера
7. **database/database.js** - функции работы с временем забега

### Особенности реализации:

- Время всегда сохраняется в часовом поясе UTC+3 (Волгоград)
- Валидация формата даты и времени
- Проверка, что время забега в будущем
- Автоматическое обновление UI при изменении времени
- Fallback на время по умолчанию при ошибках

## Безопасность

- Только администраторы могут изменять время забега
- Валидация входных данных
- Обработка ошибок и исключений
